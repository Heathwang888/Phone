<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>手機對保合約 - 定位測試</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Noto Sans TC', sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    h2 {
      text-align: center;
      margin: 30px 0;
      color: #1a237e;
      font-size: 24px;
      font-weight: bold;
    }

    form {
      max-width: 500px;
      margin: 0 auto 30px auto;
      background: #fff;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 16px;
      color: #333;
      margin-bottom: 8px;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: all 0.3s ease;
      box-sizing: border-box;
      background-color: #fff;
    }

    input:focus, select:focus {
      border-color: #1976d2;
      outline: none;
      box-shadow: 0 0 0 3px rgba(25, 118, 210, 0.1);
    }

    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1em;
      padding-right: 2.5rem;
    }

    button {
      width: 48%;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #1976d2;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    button:hover {
      background: #1565c0;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    button:active {
      transform: translateY(0);
    }

    .button-group {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      gap: 15px;
    }

    /* 隱藏預覽頁面 */
    .page-container {
      display: none;
    }

    .page {
      position: relative;
      width: 1448px;
      height: 2048px;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
    }

    .field {
      position: absolute;
      font-size: 22px;
      color: #000;
      font-weight: bold;
      letter-spacing: 1px;
      white-space: nowrap;
      pointer-events: none;
      user-select: none;
    }

    /* 響應式設計 */
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }

      h2 {
        font-size: 20px;
        margin: 20px 0;
      }

      form {
        padding: 20px;
        margin: 10px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      label {
        font-size: 15px;
      }

      input, select {
        padding: 10px;
        font-size: 15px;
      }

      .button-group {
        flex-direction: column;
      }

      button {
        width: 100%;
        margin: 5px 0;
      }
    }
  </style>
</head>
<body>
  <h2>手機對保資料填寫</h2>
  <form id="dataForm" autocomplete="off">
    <div class="form-group">
      <label>姓名</label>
      <input id="name" placeholder="請輸入姓名" autocomplete="off">
    </div>
    <div class="form-group">
      <label>身分證字號</label>
      <input id="id" placeholder="請輸入身分證字號" autocomplete="off">
    </div>
    <div class="form-group">
      <label>地址</label>
      <input id="address" placeholder="請輸入完整地址" autocomplete="off">
    </div>
    <div class="form-group">
      <label>手機型號</label>
      <select id="model">
        <option value="">請選擇型號</option>
        <option>iPhone 12</option>
        <option>iPhone 12 mini</option>
        <option>iPhone 12 Pro</option>
        <option>iPhone 12 Pro Max</option>
        <option>iPhone 13</option>
        <option>iPhone 13 mini</option>
        <option>iPhone 13 Pro</option>
        <option>iPhone 13 Pro Max</option>
        <option>iPhone 14</option>
        <option>iPhone 14 Plus</option>
        <option>iPhone 14 Pro</option>
        <option>iPhone 14 Pro Max</option>
        <option>iPhone 15</option>
        <option>iPhone 15 Plus</option>
        <option>iPhone 15 Pro</option>
        <option>iPhone 15 Pro Max</option>
        <option>iPhone 16</option>
        <option>iPhone 16 e</option>
        <option>iPhone 16 Plus</option>
        <option>iPhone 16 Pro</option>
        <option>iPhone 16 Pro Max</option>       
      </select>
    </div>
    <div class="form-group">
      <label>容量</label>
      <select id="capacity">
        <option value="">請選擇容量</option>
        <option>128G</option>
        <option>256G</option>
        <option>512G</option>
        <option>1TB</option>
      </select>
    </div>
    <div class="form-group">
      <label>IMEI碼</label>
      <input id="imei" placeholder="請輸入IMEI碼" autocomplete="off">
    </div>
    <div class="form-group">
      <label>總價</label>
      <input id="price" placeholder="請輸入總價" autocomplete="off">
    </div>
    <div class="form-group">
      <label>每日租金</label>
      <input id="rent" placeholder="請輸入每日租金" autocomplete="off">
    </div>
    <div class="form-group">
      <label>銀行分行</label>
      <input id="bank" placeholder="請輸入銀行分行" autocomplete="off">
    </div>
    <div class="form-group">
      <label>戶名</label>
      <input id="accountName" placeholder="請輸入戶名" autocomplete="off">
    </div>
    <div class="form-group">
      <label>帳號</label>
      <input id="account" placeholder="請輸入帳號" autocomplete="off">
    </div>
    <div class="button-group">
      <button type="button" onclick="fillContract()">套入合約資料</button>
      <button type="button" onclick="downloadPDF()">下載 PDF 合約</button>
    </div>
  </form>

  <div class="page-container">
    <!-- PAGE 1 -->
    <div class="page" id="contractPage1" style="background-image: url('images/page1.jpg');">
      <div class="field" id="sellerNameField" style="top:310px; left:350px;"></div>
      <div class="field" id="sellerIdField" style="top:310px; left:750px;"></div>
      <div class="field" id="sellerAddressField" style="top:390px; left:350px;"></div>
      <div class="field" id="phoneModelField" style="top:660px; left:500px;"></div>
      <div class="field" id="brandField" style="top:660px; left:300px;">APPLE</div>
      <div class="field" id="imeiField" style="top:660px; left:830px;"></div>
      <div class="field" id="totalPriceField" style="top:920px; left:500px;"></div>
      <div class="field" id="bankBranchField" style="top:1090px; left:400px;"></div>
      <div class="field" id="accountNameField" style="top:1090px; left:750px;"></div>
      <div class="field" id="accountNumberField" style="top:1090px; left:1020px;"></div>
      <div class="field" id="signerIdField" style="top:1800px; left:400px;"></div>
      <div class="field" id="yearField" style="top:1885px; left:450px;"></div>
      <div class="field" id="monthField" style="top:1885px; left:820px;"></div>
      <div class="field" id="dayField" style="top:1885px; left:1150px;"></div>
    </div>
    <!-- PAGE 2 -->
    <div class="page" id="contractPage2" style="background-image: url('images/page2.jpg');">
      <div class="field" id="contractorNameField" style="top:198px; left:380px;"></div>
      <div class="field" id="brandField" style="top:410px; left:280px;">APPLE</div>
      <div class="field" id="model2Field" style="top:410px; left:530px; letter-spacing:0px;"></div>
      <div class="field" id="imei2Field" style="top:410px; left:800px; letter-spacing:0px;"></div>
      <div class="field" id="price2Field" style="top:410px; left:1100px;"></div>
      <div class="field" id="startYearField" style="top:555px; left:535px;"></div>
      <div class="field" id="startMonthField" style="top:555px; left:625px;"></div>
      <div class="field" id="startDayField" style="top:555px; left:700px;"></div>
      <div class="field" id="endYearField" style="top:555px; left:830px;"></div>
      <div class="field" id="endMonthField" style="top:555px; left:915px;"></div>
      <div class="field" id="endDayField" style="top:555px; left:995px;"></div>
      <div class="field" id="rent2Field" style="top:625px; left:500px;"></div>
      <div class="field" id="address2Field" style="top:1825px; left:310px; letter-spacing:0px;"></div>
      <div class="field" id="id2Field" style="top:1780px; left:340px;"></div>
      <div class="field" id="year2Field" style="top:1890px; left:450px;"></div>
      <div class="field" id="month2Field" style="top:1890px; left:810px;"></div>
      <div class="field" id="day2Field" style="top:1890px; left:1160px;"></div>
    </div>
    <!-- PAGE 3 -->
    <div class="page" id="contractPage3" style="background-image: url('images/page3.jpg');">
      <div class="field" id="signerId3Field" style="top:1360px; left:345px;"></div>
      <div class="field" id="year3Field" style="top:1880px; left:450px;"></div>
      <div class="field" id="month3Field" style="top:1880px; left:750px;"></div>
      <div class="field" id="day3Field" style="top:1880px; left:1050px;"></div>
    </div>
  </div>

  <script>
    function formatNumber(num) {
      if (!num || isNaN(num)) return num;
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function toTaiwanDateParts(date) {
      const y = date.getFullYear() - 1911;
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return { year: y, month: m, day: d };
    }

    function addDays(date, days) {
      const result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    }

    function fillContract() {
      // PAGE 1
      document.getElementById('sellerNameField').innerText = document.getElementById('name').value;
      document.getElementById('sellerIdField').innerText = document.getElementById('id').value;
      document.getElementById('sellerAddressField').innerText = document.getElementById('address').value;
      document.getElementById('phoneModelField').innerText = document.getElementById('model').value;
      document.getElementById('imeiField').innerText = document.getElementById('imei').value;
      document.getElementById('totalPriceField').innerText = formatNumber(document.getElementById('price').value);
      document.getElementById('bankBranchField').innerText = document.getElementById('bank').value;
      document.getElementById('accountNameField').innerText = document.getElementById('accountName').value;
      document.getElementById('accountNumberField').innerText = document.getElementById('account').value;
      document.getElementById('signerIdField').innerText = document.getElementById('id').value;

      const today = new Date();
      const taiwan = toTaiwanDateParts(today);
      document.getElementById('yearField').innerText = taiwan.year;
      document.getElementById('monthField').innerText = taiwan.month;
      document.getElementById('dayField').innerText = taiwan.day;

      // PAGE 2
      document.getElementById('contractorNameField').innerText = document.getElementById('name').value;
      document.getElementById('model2Field').innerText = document.getElementById('model').value;
      document.getElementById('imei2Field').innerText = document.getElementById('imei').value;
      document.getElementById('price2Field').innerText = formatNumber(document.getElementById('price').value);
      document.getElementById('startYearField').innerText = taiwan.year;
      document.getElementById('startMonthField').innerText = taiwan.month;
      document.getElementById('startDayField').innerText = taiwan.day;

      const endDate = addDays(today, 7);
      const endTaiwan = toTaiwanDateParts(endDate);
      document.getElementById('endYearField').innerText = endTaiwan.year;
      document.getElementById('endMonthField').innerText = endTaiwan.month;
      document.getElementById('endDayField').innerText = endTaiwan.day;

      document.getElementById('rent2Field').innerText = formatNumber(document.getElementById('rent').value);
      document.getElementById('address2Field').innerText = document.getElementById('address').value;
      document.getElementById('id2Field').innerText = document.getElementById('id').value;
      document.getElementById('year2Field').innerText = taiwan.year;
      document.getElementById('month2Field').innerText = taiwan.month;
      document.getElementById('day2Field').innerText = taiwan.day;

      // PAGE 3
      document.getElementById('signerId3Field').innerText = document.getElementById('id').value;
      document.getElementById('year3Field').innerText = taiwan.year;
      document.getElementById('month3Field').innerText = taiwan.month;
      document.getElementById('day3Field').innerText = taiwan.day;
    }

    async function downloadPDF() {
      const jsPDF = window.jspdf.jsPDF;
      const pdf = new jsPDF('p', 'mm', 'a4');
      const pages = [
        document.getElementById('contractPage1'),
        document.getElementById('contractPage2'),
        document.getElementById('contractPage3')
      ];

      for (let i = 0; i < pages.length; i++) {
        await new Promise(resolve => {
          const bg = pages[i].style.backgroundImage;
          if (!bg) return resolve();
          const url = bg.slice(5, -2);
          const img = new window.Image();
          img.onload = resolve;
          img.onerror = resolve;
          img.src = url;
          if (img.complete) resolve();
        });

        const canvas = await html2canvas(pages[i], { scale: 2, useCORS: true });
        const imgData = canvas.toDataURL('image/jpeg', 1.0);
        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        if (i > 0) pdf.addPage();
        pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
      }

      const name = document.getElementById('name').value || '合約';
      pdf.save(`${name}-手機對保合約.pdf`);
    }
  </script>
</body>
</html>
