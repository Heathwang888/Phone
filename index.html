<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>手機對保合約 - 自動填寫</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { margin: 0; padding: 20px; font-family: 'Noto Sans TC', sans-serif; }
    .form-group { margin-bottom: 10px; }
    .page {
      position: relative;
      width: 210mm;
      height: 297mm;
      background-size: cover;
      background-repeat: no-repeat;
      margin: 30px auto;
    }
    .text-field {
      position: absolute;
      font-size: 14px;
      font-weight: bold;
      color: #000;
      white-space: nowrap;
    }
  </style>
</head>
<body>

<h2>手機對保資料填寫</h2>
<form id="dataForm">
  <div class="form-group"><label>姓名：<input id="name"></label></div>
  <div class="form-group"><label>身分證字號：<input id="id"></label></div>
  <div class="form-group"><label>地址：<input id="address"></label></div>
  <div class="form-group">
    <label>手機型號：</label>
    <select id="model">
      <option value="">請選擇型號</option>
      <option>iPhone 12</option>
      <option>iPhone 12 mini</option>
      <option>iPhone 12 Pro</option>
      <option>iPhone 12 Pro Max</option>
      <option>iPhone 13</option>
      <option>iPhone 13 mini</option>
      <option>iPhone 13 Pro</option>
      <option>iPhone 13 Pro Max</option>
      <option>iPhone 14</option>
      <option>iPhone 14 Plus</option>
      <option>iPhone 14 Pro</option>
      <option>iPhone 14 Pro Max</option>
      <option>iPhone 15</option>
      <option>iPhone 15 Plus</option>
      <option>iPhone 15 Pro</option>
      <option>iPhone 15 Pro Max</option>
    </select>
  </div>
  <div class="form-group">
    <label>容量：</label>
    <select id="capacity">
      <option value="">請選擇容量</option>
      <option>128G</option>
      <option>256G</option>
      <option>512G</option>
      <option>1TB</option>
    </select>
  </div>
  <div class="form-group"><label>IMEI碼：<input id="imei"></label></div>
  <div class="form-group"><label>總價（元）：<input id="price"></label></div>
  <div class="form-group"><label>每日租金（元）：<input id="rent"></label></div>
  <div class="form-group"><label>銀行分行：<input id="bank"></label></div>
  <div class="form-group"><label>戶名：<input id="accountName"></label></div>
  <div class="form-group"><label>帳號：<input id="account"></label></div>
  <button type="button" onclick="fillData()">套入合約資料</button>
  <button type="button" onclick="downloadPDF()">下載 PDF 合約</button>
</form>

<!-- 以下 contract page 略（保持不變） -->

<script>
function toTaiwanDate(date) {
  const y = date.getFullYear() - 1911;
  const m = String(date.getMonth() + 1).padStart(2, '0');
  const d = String(date.getDate()).padStart(2, '0');
  return `民國${y}年${m}月${d}日`;
}

function fillData() {
  const name = document.getElementById('name').value;
  const id = document.getElementById('id').value;
  const address = document.getElementById('address').value;
  const model = document.getElementById('model').value;
  const capacity = document.getElementById('capacity').value;
  const imei = document.getElementById('imei').value;
  const price = document.getElementById('price').value;
  const rent = document.getElementById('rent').value;
  const bank = document.getElementById('bank').value;
  const accountName = document.getElementById('accountName').value;
  const account = document.getElementById('account').value;
  const today = new Date();
  const taiwanToday = toTaiwanDate(today);

  document.getElementById('name1').innerText = name;
  document.getElementById('id1').innerText = id;
  document.getElementById('address1').innerText = address;
  document.getElementById('model1').innerText = model;
  document.getElementById('capacity1').innerText = capacity;
  document.getElementById('imei1').innerText = imei;
  document.getElementById('price1').innerText = price;
  document.getElementById('bank1').innerText = bank;
  document.getElementById('accountName1').innerText = accountName;
  document.getElementById('account1').innerText = account;
  document.getElementById('date1').innerText = taiwanToday;

  document.getElementById('name2').innerText = name;
  document.getElementById('id2').innerText = id;
  document.getElementById('address2').innerText = address;
  document.getElementById('model2').innerText = model;
  document.getElementById('capacity2').innerText = capacity;
  document.getElementById('imei2').innerText = imei;
  document.getElementById('price2').innerText = price;
  document.getElementById('rent2').innerText = rent;
  document.getElementById('date2').innerText = taiwanToday;

  document.getElementById('name3').innerText = name;
  document.getElementById('id3').innerText = id;
  document.getElementById('address3').innerText = address;
  document.getElementById('date3').innerText = taiwanToday;
}

async function downloadPDF() {
  const {{ jsPDF }} = window.jspdf;
  const pdf = new jsPDF('p', 'mm', 'a4');
  const pages = document.querySelectorAll('.page');
  for (let i = 0; i < pages.length; i++) {
    const canvas = await html2canvas(pages[i], { scale: 2 });
    const imgData = canvas.toDataURL('image/jpeg', 1.0);
    const imgProps = pdf.getImageProperties(imgData);
    const pdfWidth = pdf.internal.pageSize.getWidth();
    const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
    if (i > 0) pdf.addPage();
    pdf.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight);
  }
  const name = document.getElementById('name').value || '合約';
  pdf.save(`${name}-手機對保合約.pdf`);
}
</script>

</body>
</html>
